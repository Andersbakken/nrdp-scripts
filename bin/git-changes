#!/bin/sh

AUTHOR="$GIT_CHANGES_AUTHOR"
[ -z "$AUTHOR" ] && AUTHOR=`whoami`

MERGES="0"
OPTS="--pretty=format:'%h %s [%aE]'"

while [ "$#" -gt 0 ]; do
   OPT="$1"
   shift
   case $OPT in
   -i) MERGES="1" ;;
   -m) OPTS="$OPTS --author=$AUTHOR" ;;
   -t)
      tracking_branch=`git tracking`
      if [ "$?" ]; then
         branch="`git branch | grep '^\*' | cut -d ' ' -f 2`"
         echo "$branch" | grep "(" --quiet && exit 1
         OPTS="$OPTS '${tracking_branch}..${branch}'"
      fi ;;
    -1w) OPTS="$OPTS --since='7 days ago'" ;;
    *) OPTS="$OPTS $OPT";;
    esac
done
if [ "$MERGES" = "0" ]; then
    eval git log --no-merges $OPTS | grep -vi Merge-Task
else
    eval git log $OPTS
fi
