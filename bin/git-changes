#!/bin/sh

AUTHOR="$GIT_CHANGES_AUTHOR"
[ -z "$AUTHOR" ] && AUTHOR=`whoami`

OPTS=""
MERGES="0"
UNKNOWN_OPTS=""
while [ "$#" -gt 0 ]; do
   OPT="$1"
   shift
   case $OPT in
   -i) MERGES="1" ;;
   --no-merges) MERGES="0" ;;
   -m) OPTS="$OPTS --author=$AUTHOR" ;;
   -t)
      tracking_branch=`git tracking 2>/dev/null`
      if [ "$?" ]; then
         branch="`git branch | grep '^\*' | cut -d ' ' -f 2`"
         echo "$branch" | grep "(" --quiet && exit 1
         OPTS="$OPTS '${tracking_branch}..${branch}'"
      fi ;;
    -[0-9]*d) OPTS="$OPTS --since='$OPT days ago'" ;;
    -[0-9]*w) OPTS="$OPTS --since='$OPT weeks ago'" ;;
    -[0-9]*m) OPTS="$OPTS --since='$OPT months ago'" ;;
    -[0-9]*y) OPTS="$OPTS --since='$OPT years ago'" ;;
    -[0-9]*[hH]) OPTS="$OPTS --since='$OPT hours ago'" ;;
    -[0-9]*M) OPTS="$OPTS --since='$OPT minutes ago'" ;;
    -[0-9]*[sS]) OPTS="$OPTS --since='$OPT seconds ago'" ;;
    *) UNKNOWN_OPTS="$UNKNOWN_OPTS $OPT";;
    esac
done
[ "$MERGES" = "0" ] && OPTS="$OPTS --no-merges"

eval git log --oneline '--pretty="format:%C(red)%h%Creset %C(yellow)%s%Creset %C(green)%an%Creset %C(magenta)%cr%Creset%Creset%C(blue)%d%Creset"' --abbrev-commit $OPTS $UNKNOWN_OPTS
